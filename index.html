<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Do I need a Fractional Head of People?</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #f4f4f4;
    }
    .container {
      width: 90%;
      max-width: 600px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 20px;
      margin-top: 20px;
    }
    .progress-bar-track {
      width: 100%;
      background-color: #e0e0e0;
      border-radius: 4px;
      height: 8px;
      margin-bottom: 20px;
    }
    .progress-bar {
      background-color: #445953;
      height: 8px;
      border-radius: 4px;
      width: 0%;
      transition: width 0.4s ease;
    }
    h1, h2 { color: #445953; }
    button {
      background-color: #445953;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 15px;
      cursor: pointer;
      transition: background-color 0.3s;
      margin-top: 10px;
      margin-right: 8px;
    }
    button:hover { background-color: #D57A4C; }
    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }
    .hidden { display: none; }
    .question-block {
      margin-bottom: 18px;
      padding: 12px;
      background: #f9f9f9;
      border-radius: 6px;
    }
    .question-block p { margin: 0 0 8px 0; font-weight: 500; }
    .radio-group { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    .radio-group label {
      display: flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    #step-info { color: #666; font-size: 14px; margin-top: 10px; }
    .score-bar-wrap {
      background: #e0e0e0;
      border-radius: 4px;
      height: 10px;
      margin: 4px 0 10px 0;
    }
    .score-bar {
      height: 10px;
      border-radius: 4px;
      background: #445953;
      transition: width 0.5s ease;
    }
    .tier-badge {
      display: inline-block;
      padding: 8px 18px;
      border-radius: 20px;
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 12px;
      color: white;
    }
    .tier-urgent   { background-color: #dc3545; }
    .tier-soon     { background-color: #D57A4C; }
    .tier-emerging { background-color: #ffc107; color: #333; }
    .tier-notyet   { background-color: #445953; }
    .risk-item {
      background: #fff3cd;
      border-left: 4px solid #D57A4C;
      padding: 8px 12px;
      margin-bottom: 8px;
      border-radius: 4px;
    }
    .action-item {
      background: #d1ecf1;
      border-left: 4px solid #445953;
      padding: 8px 12px;
      margin-bottom: 8px;
      border-radius: 4px;
    }
    .modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0,0,0,0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      z-index: 1000;
    }
    .modal.active {
      opacity: 1;
      pointer-events: all;
    }
    .modal-content {
      background-color: white;
      padding: 24px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
    }
    .modal-content label {
      display: block;
      margin-top: 12px;
      margin-bottom: 4px;
      font-weight: 500;
    }
    .modal-content input[type="text"],
    .modal-content input[type="email"] {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .modal-content input[type="checkbox"] { margin-right: 6px; }
    #success-message { color: green; font-weight: bold; }
    #error-message { color: red; font-weight: bold; }
    .rating-scale-list {
      list-style: none;
      padding: 0;
      margin: 0 0 16px 0;
      font-size: 14px;
    }
    .rating-scale-list li {
      margin-bottom: 4px;
    }
    .sending-spinner {
      display: inline-block;
      margin-left: 8px;
      font-size: 13px;
      color: #666;
    }
  </style>
</head>
<body>

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<div class="container">

  <!-- Progress Bar -->
  <div class="progress-bar-track">
    <div class="progress-bar" id="progress-bar"></div>
  </div>

  <!-- Landing -->
  <div id="landing" class="step">
    <h1>Do I need a Fractional Head of People?</h1>
    <h2>Take this assessment to find out!</h2>
    <p>
      This 5-minute assessment will help you determine whether a Fractional Head of People
      is something you should consider now or can revisit later. You'll receive a breakdown
      of your score across five key categories, your top risk signals, and recommended next
      steps tailored to where you are today.
    </p>
    <button id="start-btn">Start</button>
  </div>

  <!-- About -->
  <div id="about" class="step hidden">
    <h2>About This Assessment</h2>
    <ul>
      <li>Assess your current people systems.</li>
      <li>Identify potential risks and gaps.</li>
      <li>Receive tailored recommendations.</li>
    </ul>
    <p><strong>Privacy Note:</strong> We'll email your results only if you choose.</p>
    <button id="next-to-assessment">Next</button>
  </div>

  <!-- Assessment -->
  <div id="assessment" class="step hidden">
    <h2 id="category-title"></h2>
    <p><strong>Rating Scale:</strong></p>
    <ul class="rating-scale-list">
      <li>1 = Strongly Disagree</li>
      <li>2 = Slightly Disagree</li>
      <li>3 = Somewhat Agree</li>
      <li>4 = Mostly Agree</li>
      <li>5 = Strongly Agree</li>
    </ul>
    <div id="questions"></div>
    <div style="margin-top:16px;">
      <button id="back-btn">Back</button>
      <button id="next-btn" disabled>Next</button>
    </div>
    <p id="step-info"></p>
  </div>

  <!-- Results -->
  <div id="results" class="hidden">
    <h2>Your Results</h2>
    <div id="result-tier"></div>
    <div id="overall-score"></div>
    <div id="category-scores"></div>
    <div id="top-risk-signals"></div>
    <div id="recommended-actions"></div>
    <button id="email-results-btn">Email me my 1-page action plan</button>
    <button id="restart-btn">Start Over</button>
  </div>

</div>

<!-- Lead Capture Modal -->
<div class="modal" id="lead-capture-modal">
  <div class="modal-content">
    <h3>Get Your Action Plan</h3>
    <label for="first-name">First Name (optional):</label>
    <input type="text" id="first-name" placeholder="Your first name">
    <label for="email">Email (required):</label>
    <input type="email" id="email" placeholder="you@example.com">
    <label style="margin-top:12px; display:flex; align-items:flex-start; gap:6px;">
      <input type="checkbox" id="insights-checkbox" checked style="margin-top:3px;">
      <span>Send me occasional insights on people systems (max 1/month).</span>
    </label>
    <button id="submit-email" style="margin-top:14px;">Submit</button>
    <span id="sending-indicator" class="sending-spinner hidden">Sending...</span>
    <p id="success-message" class="hidden">Done - check your inbox.</p>
    <p id="error-message" class="hidden">Something went wrong. Please try again.</p>
  </div>
</div>

<script>
  // Initialize EmailJS
  emailjs.init('Bm7DARr7qy74Rf5UN');

  // Data

  const questions = {
    "Clarity & Operating Model": [
      "Decisions get re-litigated because decision rights aren't clear.",
      "Ownership is fuzzy, and multiple people think they're responsible (or no one does).",
      "Roles have evolved, but expectations and success metrics haven't been updated.",
      "Cross-team handoffs regularly break because who does what isn't explicit."
    ],
    "Hiring & Ramp": [
      "We've had a costly mishire in the last 6-9 months (or we're worried we're close).",
      "New hires take longer than 60-90 days to become meaningfully productive.",
      "Interviewing is inconsistent and different interviewers evaluate different things.",
      "Onboarding quality varies widely by manager or team."
    ],
    "Managers & Performance": [
      "Managers avoid hard conversations, so issues linger too long.",
      "High performers are carrying too much because low performance isn't addressed quickly.",
      "Great performance isn't clearly defined by role, level, or function.",
      "Managers need more support coaching, feedback, delegation, and prioritization."
    ],
    "Retention & Culture": [
      "We've lost, or nearly lost, a key employee unexpectedly in the last 12 months.",
      "We don't have a reliable way to understand why people stay or leave.",
      "Recognition and growth opportunities feel inconsistent across teams.",
      "Culture and communication feel different depending on which leader you work for."
    ],
    "Risk & Foundations": [
      "We're one people issue (performance, conflict, termination) away from chaos.",
      "Policies and processes are ad hoc or unclear, creating inconsistency and risk.",
      "People data (headcount, compensation, performance, attrition) is messy or not visible, so decisions are slower.",
      "Access, onboarding, or compliance workflows aren't consistently controlled or documented."
    ]
  };

  const weights = {
    "Clarity & Operating Model": 0.25,
    "Hiring & Ramp":             0.20,
    "Managers & Performance":    0.25,
    "Retention & Culture":       0.15,
    "Risk & Foundations":        0.15
  };

  // State

  const categories = Object.keys(questions);
  const totalSteps = categories.length;
  let currentStep = 0;
  const answers = {};

  // Global result storage
  let globalScores = {};
  let globalTier = '';
  let globalOverallScore = 0;
  let globalActions = [];

  function safeKey(category, index) {
    return category.replace(/[^a-zA-Z0-9]/g, '_') + '_' + index;
  }

  function isCurrentStepAnswered() {
    const category = categories[currentStep];
    const numQuestions = questions[category].length;
    for (let i = 0; i < numQuestions; i++) {
      const key = safeKey(category, i);
      if (answers[key] === undefined || answers[key] === null) {
        return false;
      }
    }
    return true;
  }

  function updateNextButton() {
    const answered = isCurrentStepAnswered();
    nextBtn.disabled = !answered;
    nextBtn.textContent = currentStep === totalSteps - 1 ? 'See My Results' : 'Next';
  }

  function loadAssessment() {
    const category = categories[currentStep];
    document.getElementById('category-title').textContent = category;

    const container = document.getElementById('questions');
    container.innerHTML = '';

    questions[category].forEach((question, index) => {
      const key = safeKey(category, index);
      const block = document.createElement('div');
      block.className = 'question-block';

      const p = document.createElement('p');
      p.textContent = question;
      block.appendChild(p);

      const radioGroup = document.createElement('div');
      radioGroup.className = 'radio-group';

      for (let val = 1; val <= 5; val++) {
        const label = document.createElement('label');
        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = key;
        radio.value = val;

        if (answers[key] === val) {
          radio.checked = true;
        }

        (function(capturedVal, capturedKey) {
          radio.addEventListener('change', function() {
            if (this.checked) {
              answers[capturedKey] = capturedVal;
              updateNextButton();
            }
          });
        })(val, key);

        label.appendChild(radio);
        label.appendChild(document.createTextNode(' ' + val));
        radioGroup.appendChild(label);
      }

      block.appendChild(radioGroup);
      container.appendChild(block);
    });

    progressBar.style.width = `${((currentStep + 1) / totalSteps) * 100}%`;
    document.getElementById('step-info').textContent =
      `Step ${currentStep + 1} of ${totalSteps}`;

    backBtn.style.display = currentStep === 0 ? 'none' : 'inline-block';

    updateNextButton();
  }

  // Element refs

  const progressBar      = document.getElementById('progress-bar');
  const nextBtn          = document.getElementById('next-btn');
  const backBtn          = document.getElementById('back-btn');
  const leadCaptureModal = document.getElementById('lead-capture-modal');
  const emailInput       = document.getElementById('email');
  const successMessage   = document.getElementById('success-message');
  const errorMessage     = document.getElementById('error-message');
  const sendingIndicator = document.getElementById('sending-indicator');

  // Navigation Events

  document.getElementById('start-btn').addEventListener('click', () => {
    document.getElementById('landing').classList.add('hidden');
    document.getElementById('about').classList.remove('hidden');
  });

  document.getElementById('next-to-assessment').addEventListener('click', () => {
    document.getElementById('about').classList.add('hidden');
    document.getElementById('assessment').classList.remove('hidden');
    currentStep = 0;
    loadAssessment();
  });

  backBtn.addEventListener('click', () => {
    if (currentStep > 0) {
      currentStep--;
      loadAssessment();
    }
  });

  nextBtn.addEventListener('click', () => {
    if (!isCurrentStepAnswered()) return;

    if (currentStep < totalSteps - 1) {
      currentStep++;
      loadAssessment();
    } else {
      showResults();
    }
  });

  // Scoring & Results

  function showResults() {
    const scores = {};
    categories.forEach(category => {
      const numQ = questions[category].length;
      const maxPossible = numQ * 5;
      let total = 0;
      questions[category].forEach((_, index) => {
        const key = safeKey(category, index);
        total += (answers[key] || 0);
      });
      scores[category] = (total / maxPossible) * 100;
    });

    let overallScore = 0;
    categories.forEach(category => {
      overallScore += scores[category] * weights[category];
    });

    const tier = determineTier(overallScore, scores);
    const actions = getRecommendedActions(tier, scores);

    // Store globally BEFORE displaying
    globalScores = JSON.parse(JSON.stringify(scores));
    globalTier = String(tier);
    globalOverallScore = parseFloat(overallScore);
    globalActions = actions.slice();

    console.log('Stored globals:', globalTier, globalOverallScore, globalScores, globalActions);

    document.getElementById('assessment').classList.add('hidden');
    document.getElementById('results').classList.remove('hidden');

    displayResults(overallScore, tier, scores, actions);
  }

  // Tier Logic

  function determineTier(overallScore, scores) {
    if (
      scores["Risk & Foundations"]     >= 75 ||
      scores["Managers & Performance"] >= 80 ||
      overallScore >= 75
    ) return "Urgent";

    if (overallScore >= 55) return "Soon";
    if (overallScore >= 35) return "Emerging";
    return "Not Yet";
  }

  // Display Results

  function displayResults(overallScore, tier, scores, actions) {
    const tierColors = {
      "Urgent":   "tier-urgent",
      "Soon":     "tier-soon",
      "Emerging": "tier-emerging",
      "Not Yet":  "tier-notyet"
    };

    const tierDescriptions = {
      "Urgent":
        "Your organisation shows multiple high-risk signals. A Fractional Head of People could have immediate, meaningful impact.",
      "Soon":
        "You have real and growing people challenges. Engaging a Fractional Head of People in the next 1-3 months is advisable.",
      "Emerging":
        "Some early signals are present. It's worth monitoring and planning. A light-touch engagement may be beneficial.",
      "Not Yet":
        "Your people foundations appear relatively solid for now. Revisit this assessment in 3-6 months as you scale."
    };

    document.getElementById('result-tier').innerHTML = `
      <span class="tier-badge ${tierColors[tier]}">${tier}</span>
      <p>${tierDescriptions[tier]}</p>
    `;

    document.getElementById('overall-score').innerHTML = `
      <h3>Overall Score: ${overallScore.toFixed(1)} / 100</h3>
      <div class="score-bar-wrap">
        <div class="score-bar" style="width:${overallScore}%"></div>
      </div>
      <p style="font-size:13px;color:#666;">
        Higher scores indicate stronger agreement with problem statements,
        suggesting a greater need for people leadership support.
      </p>
    `;

    let catHTML = '<h3>Category Breakdown</h3>';
    categories.forEach(category => {
      const s = scores[category].toFixed(1);
      catHTML += `
        <p style="margin:4px 0 2px 0;"><strong>${category}</strong>: ${s} / 100</p>
        <div class="score-bar-wrap">
          <div class="score-bar" style="width:${s}%"></div>
        </div>
      `;
    });
    document.getElementById('category-scores').innerHTML = catHTML;

    const riskCategories = categories
      .filter(c => scores[c] >= 65)
      .sort((a, b) => scores[b] - scores[a]);

    let riskHTML = '<h3>Top Risk Signals</h3>';
    if (riskCategories.length === 0) {
      riskHTML += '<p>No categories are currently in the high-risk zone.</p>';
    } else {
      riskCategories.forEach(c => {
        riskHTML += `<div class="risk-item"><strong>${c}</strong> - Score: ${scores[c].toFixed(1)}</div>`;
      });
    }
    document.getElementById('top-risk-signals').innerHTML = riskHTML;

    let actHTML = '<h3>Recommended Next Steps</h3>';
    actions.forEach(a => {
      actHTML += `<div class="action-item">${a}</div>`;
    });
    document.getElementById('recommended-actions').innerHTML = actHTML;
  }

  // Recommended Actions

  function getRecommendedActions(tier, scores) {
    const actions = [];

    if (tier === "Urgent") {
      actions.push("Book a discovery call with a Fractional Head of People this week.");
      actions.push("Conduct a rapid people-risk audit across your top 3 scoring categories.");
    } else if (tier === "Soon") {
      actions.push("Map your current people processes and identify the top 2-3 gaps.");
      actions.push("Explore a Fractional Head of People engagement starting next quarter.");
    } else if (tier === "Emerging") {
      actions.push("Document existing people policies to create a baseline.");
      actions.push("Set a calendar reminder to re-take this assessment in 90 days.");
    } else {
      actions.push("Continue investing in manager development and culture.");
      actions.push("Revisit this assessment when headcount grows by 20%+ or post-funding.");
    }

    if (scores["Hiring & Ramp"] >= 60)
      actions.push("Standardise your interview scorecard and onboarding checklist.");
    if (scores["Managers & Performance"] >= 60)
      actions.push("Introduce structured manager coaching or a peer learning cohort.");
    if (scores["Retention & Culture"] >= 60)
      actions.push("Run stay interviews with key employees this quarter.");
    if (scores["Risk & Foundations"] >= 60)
      actions.push("Audit compliance documentation and access controls immediately.");
    if (scores["Clarity & Operating Model"] >= 60)
      actions.push("Run a RACI exercise for your top 5 recurring cross-team decisions.");

    return actions;
  }

  // Build email content

  function buildEmailContent(firstName, scores, tier, overallScore, actions) {
    const tierDescriptions = {
      "Urgent":
        "Your organisation shows multiple high-risk signals. A Fractional Head of People could have immediate, meaningful impact.",
      "Soon":
        "You have real and growing people challenges. Engaging a Fractional Head of People in the next 1-3 months is advisable.",
      "Emerging":
        "Some early signals are present. It's worth monitoring and planning. A light-touch engagement may be beneficial.",
      "Not Yet":
        "Your people foundations appear relatively solid for now. Revisit this assessment in 3-6 months as you scale."
    };

    let categoryScoresText = '';
    categories.forEach(category => {
      categoryScoresText += `${category}: ${scores[category].toFixed(1)} / 100<br>`;
    });

    const riskCategories = categories
      .filter(c => scores[c] >= 65)
      .sort((a, b) => scores[b] - scores[a]);

    let riskText = '';
    if (riskCategories.length === 0) {
      riskText = 'No categories are currently in the high-risk zone.';
    } else {
      riskCategories.forEach(c => {
        riskText += `${c} - Score: ${scores[c].toFixed(1)}<br>`;
      });
    }

    let actionsText = '';
    actions.forEach((a, i) => {
      actionsText += `${i + 1}. ${a}<br>`;
    });

    return {
      first_name: firstName || 'there',
      overall_score: overallScore.toFixed(1),
      tier: tier,
      tier_description: tierDescriptions[tier],
      category_scores: categoryScoresText,
      risk_signals: riskText,
      recommended_actions: actionsText
    };
  }

  // Lead Capture Modal

  document.getElementById('email-results-btn').addEventListener('click', () => {
    successMessage.classList.add('hidden');
    errorMessage.classList.add('hidden');
    sendingIndicator.classList.add('hidden');
    leadCaptureModal.classList.add('active');
  });

  leadCaptureModal.addEventListener('click', (e) => {
    if (e.target === leadCaptureModal) {
      leadCaptureModal.classList.remove('active');
    }
  });

  document.getElementById('submit-email').addEventListener('click', () => {
    const email = emailInput.value.trim();
    const firstName = document.getElementById('first-name').value.trim();
    const wantsInsights = document.getElementById('insights-checkbox').checked;

    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      emailInput.style.borderColor = 'red';
      return;
    }
    emailInput.style.borderColor = '#ccc';

    console.log('Sending with globals:', globalTier, globalOverallScore, globalScores, globalActions);

    const submitBtn = document.getElementById('submit-email');
    submitBtn.disabled = true;
    sendingIndicator.classList.remove('hidden');
    successMessage.classList.add('hidden');
    errorMessage.classList.add('hidden');

    const templateParams = buildEmailContent(
      firstName,
      globalScores,
      globalTier,
      globalOverallScore,
      globalActions
    );

    templateParams.user_email = email;
    templateParams.wants_insights = wantsInsights ? 'Yes' : 'No';

    const sendToUser = emailjs.send(
      'elevateIntent_service',
      'user_results',
      templateParams
    );

    const sendToAdmin = emailjs.send(
      'elevateIntent_service',
      'admin_notification',
      templateParams
    );

    Promise.all([sendToUser, sendToAdmin])
      .then(() => {
        sendingIndicator.classList.add('hidden');
        successMessage.classList.remove('hidden');
        submitBtn.disabled = false;
      })
      .catch((error) => {
        console.error('EmailJS error:', error);
        sendingIndicator.classList.add('hidden');
        errorMessage.classList.remove('hidden');
        submitBtn.disabled = false;
      });
  });

  // Restart

  document.getElementById('restart-btn').addEventListener('click', () => {
    location.reload();
  });

</script>
</body>
</html>

